0. report config
/*check data */


proc contents data=IDALPUB1.M_M_PROJ_INFO_PRD; run;
proc contents data=IDALPUB1.M_M_DISB_INFO_PRD; run;
proc contents data=IDALPUB1.O_OCR_GENERAL_PARAM_MB_PRD; run;

proc contents data=IDALPUB1.V_AUTHORIZED_DATA_POOL_PRD_2H; run;

proc contents data= IDALPUB1.V_INDIRECT_PRD_2H; run;
proc contents data= IDALPUB1.O_TRN_OCR_NOTEPAD_DTLS_PRD; run;




/*****************Import report date to the report*************************************************/
proc sql; select reportdate into:daily	from cfcpub01.AN_reportdate; 
run;
proc sql; select bdate01 into:BOM_Cur from cfcpub01.AN_reportdate ; 
run;
proc sql; select bdate02 into:BOM_Last from cfcpub01.AN_reportdate ; 
run;
proc sql; select date01 into:MTD_Cur from cfcpub01.AN_reportdate; 
run;
proc sql; select date02 into:MTD_Last from cfcpub01.AN_reportdate; 
run;

/*****************Generate variable date*************************************************/
%let LASTYEAR = INTNX('MONTH',"&daily"d,-12,'S');
%let BOLASTYEAR = INTNX('MONTH',"&daily"d,-12,'B');
%let EOMONTH = INTNX('MONTH',"&BOM_Cur"d,1,'S')-1;
%let LASTMONTH = INTNX('MONTH',"&daily"d,-1,'S');
%let EOMLASTMONTH = "&BOM_Cur"d-1;
%let End_W1 =intnx('week',"&BOM_Cur"d,0,'E');
%let End_W2 =intnx('week',"&BOM_Cur"d +7,0,'E');
%let End_W3 =intnx('week',"&BOM_Cur"d+14,0,'E');
%let End_W4 =intnx('week',"&BOM_Cur"d+21,0,'E');
%let End_W5 =intnx('week',"&BOM_Cur"d+28,0,'E');
%let End_W6 =intnx('week',"&BOM_Cur"d+30,0,'E');
PROC SQL;
	SELECT  &LASTYEAR AS A FORMAT DATE9.
			,&BOLASTYEAR AS A FORMAT DATE9.
			,&EOMONTH AS A FORMAT DATE9.
			,&LASTMONTH AS A FORMAT DATE9.
			,&EOMLASTMONTH AS A FORMAT DATE9.
			,&End_W1 AS A FORMAT DATE9.
			,&End_W2 AS A FORMAT DATE9.
			,&End_W3 AS A FORMAT DATE9.
			,&End_W4 AS A FORMAT DATE9.
			,&End_W5 AS A FORMAT DATE9.
			,&End_W6 AS A FORMAT DATE9.
	FROM _PRODSAVAIL
;
RUN;


DATA TEMPLATE;
 input ITEM $CHAR20. ;
 datalines;
	Da.W1
	b.W2
	c.W3
	d.W4
	e.W5
	f.W6
	g.FTD
	h.MTD_CUR
	i.MTD_LASTMONTH
	k.MTD_LASTYEAR
	l.EOM_CURMONTH
	m.EOM_LASTMONTH
;
1, ETL data

PROC SQL;
CREATE TABLE CFCPUB01.TBL_AUT_DATA_PENDING
AS
SELECT 
	DISTINCT A.MPI_CUST_ID,
			A.MPI_CON_ID,
			A.MPI_PROJ_ID,
			A.MPI_LEGACY_ID 						as agreementno, 
			A.mpi_app_ref_no						as APPL_REF_NUM,
			A.MPI_CUST_ID 							as CUST_ID,
			A.MPI_CON_ID							as CON_ID,
			A.MPI_PROJ_ID							as PROJ_ID,
			A.REC_ST 								as loanstatus,
			A.MPI_DPD								as DPD,
			A.MPI_DQ_STAT_CD						as DQ_STAT_CD,
			A.MPI_PREV_STAT							as PREV_STAT,
			A.MPI_DERV_STAT							as DERV_STAT,
			A.MPI_PROD_CD 							as product,
			A.MPI_SPRD_CD 							as specific_product,
			A.MPI_ST_DT								as authorized_date,						
			a.MPI_MAT_DT							as contract_closed_date,
			a.MPI_CLS_DT							as actual_closed_date,		
			a.MPI_REPMT_DT							as first_emi_date,
			a.MPI_REPMT_DT							as due_day,
			a.MPI_LOAN_VALUE 						as loan_amt,
			a.MPI_REPMT_TNR 						as tenor,
			a.MPI_NET_INT_RT 						as interest_rate,
			a.MPI_EMI 								as EMI,
			a.MPI_CR_SHIELD_FLAG					as CR_SHIELD_FLAG,
			a.MPI_CR_SHIELD_PREM_AMT				as CR_SHIELD_AMT,
			a.MPI_PAY_MODE							as Repayment_Mode,
			a.MPI_AUTO_DEBIT_LT						as Auto_Debit_Limit,
			B.MDI_DISB_DT							as disbursed_date,
			B.MDI_ACT_DISB							as disbursed_amt,
			B.MDI_NET_FRM_DISB						as deducted_amt,
			B.MDI_BENF_NAME							as customer_name,
			B.MDI_NBFC_BANK							as Account_no,
			B.MDI_BRANCH_NAME						as Branch_name,
			B.MDI_BANK_NAME							as Bank_name
	FROM IDALPUB1.M_M_PROJ_INFO_PRD A
	LEFT JOIN IDALPUB1.M_M_DISB_INFO_PRD B
		ON A.MPI_CUST_ID = B.MDI_CUST_ID
		AND A.MPI_CON_ID = B.MDI_CON_ID
		AND A.MPI_PROJ_ID = B.MDI_PROJ_ID AND B.MDI_PAY_MODE = 'P'
	WHERE 
	PUT(DATEPART(A.MPI_ST_DT),YYMMN6.) = PUT(&LASTMONTH,YYMMN6.)
	AND ( B.MDI_ACT_DISB IS NULL ) AND A.REC_ST ='A' 
/*	AND (A.REC_ST ='A' OR (A.REC_ST ='C' AND PUT(DATEPART(a.MPI_CLS_DT),YYMMN6.) =PUT(&EOMONTH,YYMMN6.) ))*/
;
RUN;


proc contents data=  CFCPUB01.TBL_AUT_DATA_PENDING; run;


PROC SQL;
CREATE TABLE TBL_AUTHORIZED_DATA_POOL_PRD_2H
AS
	SELECT 	
		A.MPI_CUST_ID
		,A.MPI_CON_ID
		,A.MPI_PROJ_ID
		,A.AGREEMENTNO
		,A.APPL_REF_NUM
		,A.CUST_ID
		,A.CON_ID
		,A.PROJ_ID
		,(CASE WHEN B.TF_CUST_ID IS NOT NULL THEN 'C'
				ELSE   A.LOANSTATUS END) AS LOANSTATUS
		,A.DPD
		,A.DQ_STAT_CD
		,A.PREV_STAT
		,A.DERV_STAT
		,A.PRODUCT
		,A.SPECIFIC_PRODUCT
		,A.AUTHORIZED_DATE
		,A.CONTRACT_CLOSED_DATE
		,(CASE WHEN B.TF_CUST_ID IS NOT NULL THEN B.TF_TRAN_DT
				ELSE   A.ACTUAL_CLOSED_DATE END) AS ACTUAL_CLOSED_DATE
		,A.FIRST_EMI_DATE
		,A.DUE_DAY
		,A.LOAN_AMT
		,A.TENOR
		,A.INTEREST_RATE
		,A.EMI
		,A.CR_SHIELD_FLAG
		,A.CR_SHIELD_AMT
		,A.REPAYMENT_MODE
		,A.AUTO_DEBIT_LIMIT
		,A.DISBURSED_DATE
		,A.DISBURSED_AMT
		,A.DEDUCTED_AMT
		,A.CUSTOMER_NAME
		,A.ACCOUNT_NO
		,A.BRANCH_NAME
		,A.BANK_NAME
FROM IDALPUB1.V_AUTHORIZED_DATA_POOL_PRD_2H A
LEFT JOIN IDALPUB1.V_FORECLOSE_HOURLY_PRD_2H B
	ON A.MPI_CUST_ID	= B.TF_CUST_ID
	AND	A.MPI_CON_ID	= B.TF_CON_ID
	AND	A.MPI_PROJ_ID	= B.TF_PROJ_ID AND B.REC_ST='A'
;
RUN;

PROC SQL;
DELETE FROM CFCPUB01.TBL_AUT_DATA_PENDING
WHERE AGREEMENTNO IN (
SELECT AGREEMENTNO FROM TBL_AUTHORIZED_DATA_POOL_PRD_2H)

;
RUN;
QUIT;

PROC SQL;
CREATE TABLE TBL_DATA_ALL
AS
SELECT PUT(&LASTYEAR,YYMMN6.) AS MONTH ,* , DATEPART(authorized_date) AS PENDING_DATE FORMAT DATE9.

FROM CFCPUB01.TBL_AUT_DATA_LASTYEAR
UNION ALL
SELECT PUT(&LASTMONTH,YYMMN6.) AS MONTH ,* ,DATEPART(authorized_date) AS PENDING_DATE FORMAT DATE9.

FROM CFCPUB01.TBL_AUT_DATA_LASTMONTH
UNION ALL
SELECT PUT(&EOMONTH,YYMMN6.) AS MONTH ,* ,DATEPART(authorized_date) AS PENDING_DATE FORMAT DATE9.

FROM TBL_AUTHORIZED_DATA_POOL_PRD_2H
UNION ALL
SELECT PUT(&EOMONTH,YYMMN6.) AS MONTH ,* ,"&BOM_Cur"D AS PENDING_DATE

FROM CFCPUB01.TBL_AUT_DATA_PENDING

;
RUN;

2, Define data
/********* Definde ESPL Product***********/
PROC SQL;
	CREATE TABLE GENERAL_PARAM
	AS
	SELECT DISTINCT KEY1, VALUE1, VALUE2
	FROM IDALPUB1.O_OCR_GENERAL_PARAM_MB_PRD
	WHERE KEY1 LIKE '%CAMPAIGN_PRODUCTCODE%'
	ORDER BY  1,2,3;
RUN;



PROC SQL;
	CREATE TABLE CAMPAIGN_CODE
	AS
	SELECT 	APPL_REF_NUM 
			,INPUTTER_ID
			,COMPAIGN_CODE 
			,COMPAIGN_CODE2 
			,COMPAIGN_CODE3 
			,COMPAIGN_CODE4 FORMAT $30.
			,INPUTTER_DT
	FROM (	SELECT * FROM IDALPUB1.O_TRN_OCR_REGISTRATION_DTL_PRD
			UNION ALL
			SELECT * FROM IDALPUB1.V_REGISTRATION_DTL_PRD_2H)
	WHERE 	INPUTTER_ID ^= 'MIGMKR' AND KEY1='REGISTRATION' 
			AND DATEPART(INPUTTER_DT) >='01SEP20'D
;
RUN;

PROC SQL;
CREATE TABLE  TBL_CAMPAIGN_ESPL 
AS
	SELECT 	A.APPL_REF_NUM AS APP_ID
			,A.INPUTTER_ID AS INPUT_USER
			,A.INPUTTER_DT
			,B.VALUE2 format $30. as COMPAIGN_1
			,C.VALUE2 format $30. as COMPAIGN_2
			,D.VALUE2 format $30. as COMPAIGN_3
			,E.VALUE2 format $30. as COMPAIGN_4
	FROM CAMPAIGN_CODE A
	LEFT JOIN GENERAL_PARAM B on a.COMPAIGN_CODE  = b.value1 and b.key1 = 'CAMPAIGN_PRODUCTCODE'
	LEFT JOIN GENERAL_PARAM C on a.COMPAIGN_CODE2 = c.value1 and c.key1 = 'CAMPAIGN_PRODUCTCODE1'
	LEFT JOIN GENERAL_PARAM D on a.COMPAIGN_CODE3 = d.value1 and d.key1 = 'CAMPAIGN_PRODUCTCODE2'
	LEFT JOIN GENERAL_PARAM E on a.COMPAIGN_CODE4 = e.value1 and e.key1 = 'CAMPAIGN_PRODUCTCODE3'
	WHERE B.VALUE2 IN('ESPL1','ESPL_DIGITAL')
	ORDER BY 1,2,3,4,5,6
	; 
RUN;


/**************** Define datamart ********/



PROC SQL;
CREATE TABLE TBL_LOAN_INFO
AS
	SELECT 
	DISTINCT 
				A.MONTH
			,A.MPI_CUST_ID
			,A.MPI_CON_ID
			,A.MPI_PROJ_ID
			,A.agreementno 	length 10 format $10. 
			,A.APPL_REF_NUM	format $20.
			,A.CUST_ID 		format $10.
			,A.CON_ID		format $4.
			,A.PROJ_ID		format $4.
			,A.loanstatus 
			,A.DPD
			,A.DQ_STAT_CD	format $10.
			,A.PREV_STAT		format $10.
			,A.DERV_STAT		format $10.
			,A.product 	format $8.	
			,A.specific_product 	format $8.
			,A.authorized_date						
			,datepart(a.contract_closed_date) format date9.	as contract_closed_date 
			,datepart(a.actual_closed_date) format date9.	as actual_closed_date	
			,datepart(a.first_emi_date) format date9.	as first_emi_date
			,day(datepart(a.due_day))			as due_day
			,a.loan_amt
			,a.tenor 	
			,a.interest_rate 					
			,a.EMI 								
			,a.CR_SHIELD_FLAG	format $10.
			,a.CR_SHIELD_AMT			
			,a.Repayment_Mode			format $10.		
			,a.Auto_Debit_Limit						
			,datepart(A.disbursed_date) format date9.	as disbursed_date
			,A.disbursed_amt					
			,A.deducted_amt				
			,A.customer_name						
			,A.Account_no						
			,A.Branch_name					
			,A.Bank_name	
			,A.PENDING_DATE	
/*			,(CASE WHEN C.APPL_REF_NUM IS NOT NULL THEN 'INDIRECT' ELSE 'Normal' END) AS INDIRECT_FLAG*/
			,(CASE WHEN D.APP_ID IS NOT NULL THEN 'ESPL1' ELSE 'Normal' END) AS ESPL_FLAG

	FROM 
	TBL_DATA_ALL A
/*	LEFT JOIN TBL_INDIRECT C ON C.APPL_REF_NUM = A.APPL_REF_NUM*/
	LEFT JOIN TBL_CAMPAIGN_ESPL D ON D.APP_ID = A.APPL_REF_NUM
;
RUN;




/**/
/*PROC SQL;*/
/*UPDATE*/
/*TBL_LOAN_INFO*/
/*SET LOANSTATUS ='C',actual_closed_date = '23OCT2020'D */
/*WHERE AGREEMENTNO IN ('100398401'*/
/*,'100398441'*/
/*,'100401273'*/
/*,'100399765'*/
/*,'100401207'*/
/*,'100398437'*/
/*,'100401237'*/
/*,'100401127'*/
/*,'100397145'*/
/*,'100400793'*/
/*,'100401229'*/
/*,'100399495'*/
/*,'100401219'*/
/*,'100401777'*/
/*,'100401489'*/
/*,'100401429'*/
/*,'100401879'*/
/*,'100401903'*/
/*,'100394559'*/
/*,'100401053'*/
/*,'100401991'*/
/*,'100402031'*/
/*,'100400365'*/
/*)*/
/*;*/
/*RUN;*/

3. Indirect disbursal


/********* Define Indirect disbursal***********/

PROC SQL;
CREATE TABLE TBL_CL_ALL
AS
	SELECT *
	FROM IDALPUB1.O_TRN_OCR_NOTEPAD_DTLS_PRD A
	WHERE  A.NOTE_CODE LIKE 'CL%' 
UNION ALL 
	SELECT *
	FROM IDALPUB1.V_INDIRECT_PRD_2H A
;
RUN;

/**/
/*PROC SQL;*/
/*CREATE TABLE TBL_INDIRECT*/
/*AS*/
/*SELECT DISTINCT APPL_REF_NUM*/
/*	FROM TBL_CL_ALL*/
/*;*/
/*RUN;*/

proc sort data=TBL_CL_ALL; by appl_ref_num note_code inputted_date;

data note_CL_1;
set  TBL_CL_ALL;
by   appl_ref_num note_code inputted_date;
if   last.note_code then output;
run;

/* proc contents data= note_CL;  16602 */

/* proc contents data= note_CL_1;  15672*/



data note_CL_2;
set  note_CL_1;
  length next_pair dimension value $200;
  cnt = 1;
  next_pair = scan(comments,cnt,"#");
  do while (next_pair ne "");
    dimension = scan(next_pair,1,":");
    value = scan(next_pair,2,":");
    output;
    cnt = cnt + 1;
    next_pair = scan(comments,cnt,"#");
  end;
  keep appl_ref_num note_code dimension value;
run;

data note_CL_3;
set  note_CL_2;
format loan_amt_3rd 9.;
if dimension in ('DisbursalAmount');
loan_amt_3rd = input(value,9.);
;run;

/*proc transpose data=note_CL_3 out=note_CL_4(drop=_name_);*/
/*by appl_ref_num note_code;*/
/*  id  dimension;*/
/*  var value;*/
/*run;*/

proc sql;
create table TBL_INDIRECT_T3 as
select appl_ref_num ,sum(loan_amt_3rd) as loan_amt_3rd	 
from note_CL_3
group by appl_ref_num;
quit;

4, Data reparation


PROC SQL;
CREATE TABLE CFCPUB01.TBL_RAW_DATA_FULL
AS
	SELECT 	A.MONTH
			,A.AGREEMENTNO	
			,A.APPL_REF_NUM
			,A.LOANSTATUS
			,A.PRODUCT
			,( CASE WHEN ESPL_FLAG ='ESPL1' THEN 'Easy Loan'
					WHEN specific_product = 'SFXSEL' then 'X-sell'
					WHEN specific_product = 'PTOPUP' then 'Top-up'
					WHEN specific_product = 'SELPIL' then 'PL Self-emp'
					WHEN specific_product =  'SALPIL' then 'PL Salaried'
					WHEN specific_product = 'INSPIL' then 'PL Insurance'
					WHEN specific_product =  'CORPIL' then 'PL CELP'
					WHEN specific_product =  'CRDPIL' then  'PL Card'
					WHEN specific_product IN ('FTKSFN','NPRSFN') then 'Sales finance'
					WHEN specific_product = 'AUTFIX' then 'Auto Loan' END) AS PRODUCT_NAME
			,(
				CASE WHEN specific_product = 'AUTFIX' then 'Auto Loan'
					WHEN  LOAN_AMT >100000000 then 'Living need'
					ELSE 'PL' END
				) AS PRODUCT_CAT
			,( CASE WHEN LOANSTATUS = 'C' AND DISBURSED_AMT IS NULL THEN 'Y' ELSE 'N' END) AS DELETE_FLAG
			,( CASE WHEN LOANSTATUS = 'A' AND DISBURSED_AMT IS NULL THEN 'Y' 
/*					WHEN LOANSTATUS = 'A' AND DATEPART(AUTHORIZED_DATE) < DISBURSED_DATE  THEN 'Y'*/
					ELSE 'N' END) AS PENDING_FLAG
			,( CASE WHEN LOAN_AMT <=20000000 THEN 'Y' ELSE 'N' END) AS MIL20
			,DATEPART(AUTHORIZED_DATE) AS AUTHORIZED_DATE  FORMAT DATE9. 
			,LOAN_AMT
			,CR_SHIELD_AMT
			,DISBURSED_DATE
			,DISBURSED_AMT
			,DEDUCTED_AMT	
			,ESPL_FLAG
			,actual_closed_date
			,PENDING_DATE
			,(CASE WHEN B.APPL_REF_NUM IS NOT NULL THEN 'INDIRECT' ELSE 'Normal' END) AS INDIRECT_FLAG 
			,(CASE WHEN B.APPL_REF_NUM IS NOT NULL THEN B.loan_amt_3rd ELSE 0 END) AS T3_AMT 
			, COALESCE(LOAN_AMT,0) - COALESCE(CR_SHIELD_AMT,0) - COALESCE(calculated  T3_AMT,0) AS DISBURSED_CUS 
			,( CASE WHEN CALCULATED DISBURSED_CUS <=20000000 THEN 'Y' ELSE 'N' END) AS MIL20CUS
/***********************************Authorized date***********************************/
			,PUT(DATEPART(A.authorized_date),YYMMN6.) AS MONTH_AUTH
			,intck('week',intnx('month',DATEPART(A.authorized_date),0),DATEPART(A.authorized_date))+1 AS WEEK_AUTH
			,DAY(DATEPART(A.authorized_date)) AS DATE_AUTH
/***********************************Dibursed date***********************************/
			,PUT(A.disbursed_date,YYMMN6.) AS MONTH_DISB
			,intck('week',intnx('month',A.disbursed_date,0),A.disbursed_date)+1 AS WEEK_DISB
			,DAY(A.disbursed_date) AS DATE_DISB
/***********************************Closed date***********************************/
			,PUT(A.actual_closed_date,YYMMN6.) AS MONTH_CLOS
			,intck('week',intnx('month',A.actual_closed_date,0),A.actual_closed_date)+1 AS WEEK_CLOS
			,DAY(A.actual_closed_date) AS DATE_CLOS
/***********************************Pending date***********************************/
			,PUT(A.PENDING_DATE,YYMMN6.) AS MONTH_PEN
			,intck('week',intnx('month',A.PENDING_DATE,0),A.PENDING_DATE)+1 AS WEEK_PEN
			,DAY(A.PENDING_DATE) AS DATE_PEN
	FROM TBL_LOAN_INFO A
	LEFT JOIN TBL_INDIRECT_T3 B ON A.APPL_REF_NUM = B.APPL_REF_NUM
/*	WHERE A.AGREEMENTNO ='100400139'*/
;
RUN;
QUIT;



proc contents data=  TBL_LOAN_INFO; run;



PROC SQL;
CREATE TABLE TBL_POOL
AS
	SELECT 
			'a.W1' AS ITEM
			,'N' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_AUTH=1  AND MONTH_AUTH = PUT(&EOMONTH,YYMMN6.)= MONTH 
	UNION ALL
	SELECT 
			'a.W1' AS ITEM
			,'Y' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_DISB=1 AND MONTH_DISB = PUT(&EOMONTH,YYMMN6.) = MONTH

	UNION ALL
	SELECT 
			'a.W1' AS ITEM
			,'C' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_CLOS=1 AND MONTH_CLOS = PUT(&EOMONTH,YYMMN6.) = MONTH
/*	UNION ALL*/
/*	SELECT */
/*			'a.W1' AS ITEM*/
/*			,'P' AS DISB_FLAG*/
/*			,**/
/*	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_PEN=1 AND MONTH_PEN = PUT(&EOMONTH,YYMMN6.)*/


	/*******/
	UNION ALL
		SELECT 
			'b.W2' AS ITEM
			,'N' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_AUTH=2 AND MONTH_AUTH = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'b.W2' AS ITEM
			,'Y' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_DISB=2 AND MONTH_DISB = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'b.W2' AS ITEM
			,'C' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_CLOS=2 AND MONTH_CLOS = PUT(&EOMONTH,YYMMN6.) = MONTH
/*	UNION ALL*/
/*	SELECT */
/*			'b.W2' AS ITEM*/
/*			,'P' AS DISB_FLAG*/
/*			,**/
/*	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_PEN=2 AND MONTH_PEN = PUT(&EOMONTH,YYMMN6.) = MONTH*/

	/********/
	UNION ALL
		SELECT 
			'c.W3' AS ITEM
			,'N' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_AUTH=3 AND MONTH_AUTH = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'c.W3' AS ITEM
			,'Y' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_DISB=3 AND MONTH_DISB = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'c.W3' AS ITEM
			,'C' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_CLOS=3 AND MONTH_CLOS = PUT(&EOMONTH,YYMMN6.) = MONTH
/*	UNION ALL*/
/*	SELECT */
/*			'c.W3' AS ITEM*/
/*			,'P' AS DISB_FLAG*/
/*			,**/
/*	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_PEN=3 AND MONTH_PEN = PUT(&EOMONTH,YYMMN6.) = MONTH*/


	/********/
	UNION ALL
	SELECT 
			'd.W4' AS ITEM
			,'N' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_AUTH=4 AND MONTH_AUTH = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'd.W4' AS ITEM
			,'Y' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_DISB=4 AND MONTH_DISB = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'd.W4' AS ITEM
			,'C' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_CLOS=4 AND MONTH_CLOS = PUT(&EOMONTH,YYMMN6.) = MONTH
/*	UNION ALL*/
/*	SELECT */
/*			'd.W4' AS ITEM*/
/*			,'P' AS DISB_FLAG*/
/*			,**/
/*	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_PEN=4 AND MONTH_PEN = PUT(&EOMONTH,YYMMN6.) = MONTH*/
	/********/
	UNION ALL
	SELECT 
			'e.W5' AS ITEM
			,'N' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_AUTH=5 AND MONTH_AUTH = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'e.W5' AS ITEM
			,'Y' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_DISB=5 AND MONTH_DISB = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'e.W5' AS ITEM
			,'C' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_CLOS=5 AND MONTH_CLOS = PUT(&EOMONTH,YYMMN6.) = MONTH
/*	UNION ALL*/
/*	SELECT */
/*			'e.W5' AS ITEM*/
/*			,'P' AS DISB_FLAG*/
/*			,**/
/*	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_PEN=5 AND MONTH_PEN = PUT(&EOMONTH,YYMMN6.) = MONTH*/


	/********/
	UNION ALL
	SELECT 
			'f.W6' AS ITEM
			,'N' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_AUTH=6 AND MONTH_AUTH = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'f.W6' AS ITEM
			,'Y' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_DISB=6 AND MONTH_DISB = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'f.W6' AS ITEM
			,'C' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_CLOS=6 AND MONTH_CLOS = PUT(&EOMONTH,YYMMN6.)= MONTH
/*	UNION ALL*/
/*	SELECT */
/*			'f.W6' AS ITEM*/
/*			,'P' AS DISB_FLAG*/
/*			,**/
/*	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE WEEK_PEN=6 AND MONTH_PEN = PUT(&EOMONTH,YYMMN6.) = MONTH*/
	/**********/
	UNION ALL
	SELECT 
			'g.FTD' AS ITEM
			,'N' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE  authorized_date = "&daily"D AND MONTH_AUTH = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'g.FTD' AS ITEM
			,'Y' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE  disbursed_date = "&daily"D AND MONTH_DISB = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'g.FTD' AS ITEM
			,'C' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE  actual_closed_date = "&daily"D AND MONTH_CLOS = PUT(&EOMONTH,YYMMN6.)= MONTH
	UNION ALL
	SELECT 
			'g.FTD' AS ITEM
			,'P' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE DISBURSED_AMT IS NULL AND  PENDING_DATE >= "&BOM_Cur"D AND MONTH_PEN = PUT(&EOMONTH,YYMMN6.) = MONTH

	/********/
	UNION ALL
	SELECT 
			'h.MTD_CUR' AS ITEM
			,'N' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE authorized_date >= "&BOM_Cur"D AND MONTH_AUTH = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'h.MTD_CUR' AS ITEM
			,'Y' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE disbursed_date >= "&BOM_Cur"D AND MONTH_DISB = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'h.MTD_CUR' AS ITEM
			,'C' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE actual_closed_date >= "&BOM_Cur"D AND MONTH_CLOS = PUT(&EOMONTH,YYMMN6.)= MONTH
/*	UNION ALL*/
/*	SELECT */
/*			'h.MTD_CUR' AS ITEM*/
/*			,'P' AS DISB_FLAG*/
/*			,**/
/*	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE PENDING_DATE >= "&BOM_Cur"D AND MONTH_PEN = PUT(&EOMONTH,YYMMN6.)*/
/**/

	/*********/
	UNION ALL
	SELECT 
			'i.MTD_LASTMONTH' AS ITEM
			,'N' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE "&BOM_Last"D<= authorized_date <= &LASTMONTH AND MONTH_AUTH = PUT(&LASTMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'i.MTD_LASTMONTH' AS ITEM
			,'Y' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE "&BOM_Last"D<= disbursed_date <= &LASTMONTH AND MONTH_DISB = PUT(&LASTMONTH,YYMMN6.) = MONTH

	UNION ALL
	SELECT 
			'i.MTD_LASTMONTH' AS ITEM
			,'C' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE "&BOM_Last"D<= actual_closed_date <= &LASTMONTH AND MONTH_CLOS = PUT(&LASTMONTH,YYMMN6.) = MONTH
/*	UNION ALL*/
/*	SELECT */
/*			'i.MTD_LASTMONTH' AS ITEM*/
/*			,'P' AS DISB_FLAG*/
/*			,**/
/*	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE "&BOM_Last"D<= PENDING_DATE <= &LASTMONTH AND MONTH_PEN = PUT(&LASTMONTH,YYMMN6.)*/

	/*******/

	UNION ALL
	SELECT 
			'k.MTD_LASTYEAR' AS ITEM
			,'N' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE &BOLASTYEAR<=authorized_date <= &LASTYEAR AND MONTH_AUTH = PUT(&LASTYEAR,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'k.MTD_LASTYEAR' AS ITEM
			,'Y' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE &BOLASTYEAR<=disbursed_date <= &LASTYEAR AND MONTH_DISB = PUT(&LASTYEAR,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'k.MTD_LASTYEAR' AS ITEM
			,'C' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE &BOLASTYEAR<=actual_closed_date <= &LASTYEAR AND MONTH_CLOS = PUT(&LASTYEAR,YYMMN6.) = MONTH
/*	UNION ALL*/
/*	SELECT */
/*			'k.MTD_LASTYEAR' AS ITEM*/
/*			,'P' AS DISB_FLAG*/
/*			,**/
/*	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE &BOLASTYEAR<=PENDING_DATE <= &LASTYEAR AND MONTH_PEN = PUT(&LASTYEAR,YYMMN6.) */

	/********/
	UNION ALL
	SELECT 
			'l.EOM_CURMONTH' AS ITEM
			,'N' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE authorized_date >= "&BOM_Cur"D AND MONTH_AUTH = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'l.EOM_CURMONTH' AS ITEM
			,'Y' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE disbursed_date >= "&BOM_Cur"D AND MONTH_DISB = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'l.EOM_CURMONTH' AS ITEM
			,'C' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE actual_closed_date >= "&BOM_Cur"D AND MONTH_CLOS = PUT(&EOMONTH,YYMMN6.) = MONTH
/*	UNION ALL*/
/*	SELECT */
/*			'l.EOM_CURMONTH' AS ITEM*/
/*			,'P' AS DISB_FLAG*/
/*			,**/
/*	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE PENDING_DATE >= "&BOM_Cur"D AND MONTH_PEN = PUT(&EOMONTH,YYMMN6.) */

	/********/
	UNION ALL
	SELECT 
			'm.EOM_LASTMONTH' AS ITEM
			,'N' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE authorized_date >="&BOM_Last"D  AND MONTH_AUTH = PUT(&LASTMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'm.EOM_LASTMONTH' AS ITEM
			,'Y' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE disbursed_date >= "&BOM_Last"D AND MONTH_DISB = PUT(&LASTMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			'm.EOM_LASTMONTH' AS ITEM
			,'C' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE actual_closed_date >= "&BOM_Last"D AND MONTH_CLOS = PUT(&LASTMONTH,YYMMN6.)= MONTH
/*	UNION ALL*/
/*	SELECT */
/*			'm.EOM_LASTMONTH' AS ITEM*/
/*			,'P' AS DISB_FLAG*/
/*			,**/
/*	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE PENDING_DATE >= "&BOM_Last"D AND MONTH_PEN = PUT(&LASTMONTH,YYMMN6.) */
;
RUN;
QUIT;



/*------------WORKING TIME--------*/


PROC SQL;
CREATE TABLE TBL1
AS
SELECT DISTINCT A.MONTH, A.AUTHORIZED_DATE,A.WEEK_AUTH
FROM CFCPUB01.TBL_RAW_DATA_FULL A WHERE A.MONTH =A.MONTH_AUTH
;
RUN;
QUIT;


PROC SQL;
CREATE TABLE TBL_FULL_WORKING
AS
SELECT A.*,B.INDEX
FROM TBL1 A
LEFT JOIN cfcpub01.Working_OP B ON A.AUTHORIZED_DATE = B.DATE
;
RUN;
QUIT;









PROC SQL;
CREATE TABLE WK_CURRENTMONTH
AS
SELECT *
FROM TBL_FULL_WORKING A WHERE A.MONTH = PUT(&EOMONTH,YYMMN6.)
;
RUN;
QUIT;

PROC SQL;
SELECT CASE WHEN SUM(INDEX) IS NULL THEN 0 ELSE SUM(INDEX) END INTO:WD_W1
FROM WK_CURRENTMONTH WHERE WEEK_AUTH =1
;
RUN;
QUIT;

PROC SQL;
SELECT CASE WHEN SUM(INDEX) IS NULL THEN 0 ELSE SUM(INDEX) END INTO:WD_W2
FROM WK_CURRENTMONTH WHERE WEEK_AUTH =2
;
RUN;
QUIT;

PROC SQL;
SELECT CASE WHEN SUM(INDEX) IS NULL THEN 0 ELSE SUM(INDEX) END INTO:WD_W3
FROM WK_CURRENTMONTH WHERE WEEK_AUTH =3
;
RUN;
QUIT;

PROC SQL;
SELECT CASE WHEN SUM(INDEX) IS NULL THEN 0 ELSE SUM(INDEX) END INTO:WD_W4
FROM WK_CURRENTMONTH WHERE WEEK_AUTH =4
;
RUN;
QUIT;

PROC SQL;
SELECT CASE WHEN SUM(INDEX) IS NULL THEN 0 ELSE SUM(INDEX) END INTO:WD_W5
FROM WK_CURRENTMONTH WHERE WEEK_AUTH =5
;
RUN;
QUIT;

PROC SQL;
SELECT CASE WHEN SUM(INDEX) IS NULL THEN 0 ELSE SUM(INDEX) END INTO:WD_W6
FROM WK_CURRENTMONTH WHERE WEEK_AUTH =6
;
RUN;
QUIT;


PROC SQL;
SELECT CASE WHEN SUM(INDEX) IS NULL THEN 0 ELSE SUM(INDEX) END INTO:WD_FTD
FROM WK_CURRENTMONTH WHERE AUTHORIZED_DATE ="&daily"D
;
RUN;
QUIT;



PROC SQL;
SELECT CASE WHEN SUM(INDEX) IS NULL THEN 0 ELSE SUM(INDEX) END INTO:WD_MTD_CUR
FROM WK_CURRENTMONTH
;
RUN;
QUIT;



PROC SQL;
CREATE TABLE WK_LASTMONTH
AS
SELECT *
FROM TBL_FULL_WORKING A WHERE A.MONTH = PUT(&EOMLASTMONTH,YYMMN6.)
;
RUN;
QUIT;




PROC SQL;
SELECT CASE WHEN SUM(INDEX) IS NULL THEN 0 ELSE SUM(INDEX) END INTO:WD_MTD_LAST
FROM WK_LASTMONTH WHERE AUTHORIZED_DATE <=&LASTMONTH
;
RUN;
QUIT;

PROC SQL;
SELECT CASE WHEN SUM(INDEX) IS NULL THEN 0 ELSE SUM(INDEX) END INTO:WD_EOM_LAST
FROM WK_LASTMONTH
;
RUN;
QUIT;



PROC SQL;

SELECT CASE WHEN SUM(INDEX) IS NULL THEN 0 ELSE SUM(INDEX) END INTO:WD_MTD_LASTYEAR
FROM TBL_FULL_WORKING A WHERE A.MONTH = PUT(&LASTYEAR,YYMMN6.)
AND A.AUTHORIZED_DATE <=&LASTYEAR
;
RUN;
QUIT;


5. Summary

PROC SQL;
CREATE TABLE TBL_TEMPLATE1
AS
SELECT A.ITEM 
		,(CASE WHEN ITEM ='a.W1' THEN &WD_W1
				WHEN ITEM ='b.W2' THEN &WD_W2
				WHEN ITEM ='c.W3' THEN &WD_W3
				WHEN ITEM ='d.W4' THEN &WD_W4
				WHEN ITEM ='e.W5' THEN &WD_W5
				WHEN ITEM ='f.W6' THEN &WD_W6
				WHEN ITEM ='g.FTD' THEN &WD_FTD
				WHEN ITEM ='h.MTD_CUR' THEN &WD_MTD_CUR
				WHEN ITEM ='i.MTD_LASTMONTH' THEN &WD_MTD_LAST
				WHEN ITEM ='k.MTD_LASTYEAR' THEN &WD_MTD_LASTYEAR
				WHEN ITEM ='l.EOM_CURMONTH' THEN &WD_MTD_CUR
				WHEN ITEM ='m.EOM_LASTMONTH' THEN &WD_EOM_LAST 
				ELSE 0 END ) AS WORKING_DATE
FROM CFCPUB01.TBL_AUT_TEMPLATE A 
;
RUN;

%let USD=23172500;

PROC SQL;
CREATE TABLE TBL_SUM1
AS
SELECT A.ITEM 
/*		,(CASE WHEN ITEM ='a.W1' THEN &WD_W1*/
/*				WHEN ITEM ='b.W2' THEN &WD_W2 - &WD_W1*/
/*				WHEN ITEM ='c.W3' THEN &WD_W3 - &WD_W2*/
/*				WHEN ITEM ='d.W4' THEN &WD_W4 -&WD_W3*/
/*				WHEN ITEM ='e.W5' AND &WD_W5 >0  THEN &WD_W5*/
/*				WHEN ITEM ='e.W5' AND &WD_W5 =0  THEN &WD_WEOM*/
/*				WHEN ITEM ='f.W6' AND &WD_W5 =0 THEN 0*/
/*				WHEN ITEM ='f.W6' AND &WD_W6 >0 THEN &WD_W6*/
/*				WHEN ITEM ='f.W6' AND &WD_W6 >0 THEN &WD_WEOM*/
/*				WHEN ITEM ='g.FTD' THEN &WD_FTD*/
/*				WHEN ITEM ='h.MTD_CUR' THEN &WD_MTD_CUR*/
/*				WHEN ITEM ='i.MTD_LASTMONTH' THEN &WD_MTD_LAST*/
/*				WHEN ITEM ='k.MTD_LASTYEAR' THEN &WD_MTD_LASTYEAR*/
/*				WHEN ITEM ='l.EOM_CURMONTH' THEN &WD_EOM_CUR*/
/*				WHEN ITEM ='m.EOM_LASTMONTH' THEN &WD_EOM_LAST */
/*				ELSE 0 END ) AS WORKING_DATE*/
		/***********************************AUTHORIZED CASE********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'N' THEN 1 ELSE 0 END) AS AUT_TOTAL
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL'   THEN 1 ELSE 0 END) AS AUT_PL
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
																,'PL Card')
										THEN 1 ELSE 0 END) AS AUT_REGULAR
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND PRODUCT_NAME IN ('Top-up')
										THEN 1 ELSE 0 END) AS AUT_TOPUP
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND PRODUCT_NAME IN ('Easy Loan')
										THEN 1 ELSE 0 END) AS AUT_EASY
		
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND MIL20 ='Y'
										THEN 1 ELSE 0 END) AS AUT_PL_20MIL
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND MIL20 ='N'
										THEN 1 ELSE 0 END) AS AUT_PL_21MIL

		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='Living need'   THEN 1 ELSE 0 END) AS AUT_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='Auto Loan'   THEN 1 ELSE 0 END) AS AUT_AUTO
		/*************************************AUTHORIZED AMOUNT*******************************************/
		,SUM( CASE WHEN DISB_FLAG = 'N' THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_TOTAL
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL'   THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_PL
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
																,'PL Card')
										THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_REGULAR
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND PRODUCT_NAME IN ('Top-up')
										THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_TOPUP
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND PRODUCT_NAME IN ('Easy Loan')
										THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_EASY
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND MIL20 ='Y'
										THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_PL20MIL
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND MIL20 ='N'
										THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_PL21MIL
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='Living need'   THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='Auto Loan'   THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_AUTO
		/***************************************DELETE CASE********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' THEN 1 ELSE 0 END) AS DEL_TOTAL
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='PL'   THEN 1 ELSE 0 END) AS DEL_PL
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='PL'  AND MIL20='Y' THEN 1 ELSE 0 END) AS DEL_PLMIL20
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='PL' AND MIL20='N'  THEN 1 ELSE 0 END) AS DEL_PLMIL21
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='Living need'   THEN 1 ELSE 0 END) AS DEL_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='Auto Loan'   THEN 1 ELSE 0 END) AS DEL_AUTO
		/***************************************DELETE AMOUT********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' THEN LOAN_AMT ELSE 0 END)/&USD AS DEL_AMT_TOTAL
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='PL'   THEN LOAN_AMT ELSE 0 END)/&USD AS DEL_AMT_PL
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='PL' AND MIL20='Y'   THEN LOAN_AMT ELSE 0 END)/&USD AS DEL_AMT_PLMIL20
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='PL' AND MIL20='N'  THEN LOAN_AMT ELSE 0 END)/&USD AS DEL_AMT_PLMIL21
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='Living need'   THEN LOAN_AMT ELSE 0 END)/&USD AS DEL_AMT_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='Auto Loan'   THEN LOAN_AMT ELSE 0 END)/&USD AS DEL_AMT_AUTO


		/***************************************DISBURSAL PL REGULAR PRODUCT********************************************/

		/*Part 1-Amount <=20mil*/

		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL'  AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
							,'PL Card','Easy Loan') AND MIL20 ='Y' THEN DISBURSED_CUS ELSE 0 END)/&USD AS DISB_AMT_PL_P1

		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
							,'PL Card','Easy Loan') AND MIL20 ='Y'   THEN T3_AMT ELSE 0 END)/&USD AS DISB_AMT_PL_T3_P1

		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
							,'PL Card','Easy Loan') AND MIL20 ='Y'  THEN CR_SHIELD_AMT ELSE 0 END)/&USD AS DISB_AMT_PL_SHIEDL_P1
		/*Part 2- Amount >20mil*/

		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL'  AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
											,'PL Card','Easy Loan') AND MIL20 ='N' THEN DISBURSED_CUS ELSE 0 END)/&USD AS DISB_AMT_PL_P2
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
																,'PL Card','Easy Loan') AND MIL20 ='N'
												AND MIL20CUS ='Y'  THEN DISBURSED_CUS ELSE 0 END)/&USD AS DISB_AMT_PL20_P2
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
																,'PL Card','Easy Loan')AND MIL20 ='N'
												AND MIL20CUS ='N'  THEN DISBURSED_CUS ELSE 0 END)/&USD AS DISB_AMT_PL21_P2
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
												,'PL Card','Easy Loan') AND MIL20 ='N'   THEN T3_AMT ELSE 0 END)/&USD AS DISB_AMT_PL_T3_P2
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
												,'PL Card','Easy Loan') AND MIL20 ='N'   THEN CR_SHIELD_AMT ELSE 0 END)/&USD AS DISB_AMT_PL_SHIEDL_P2

		/***************************************DISBURSAL TOPUP PRODUCT********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' 
										AND PRODUCT_NAME IN ('Top-up')   THEN DISBURSED_CUS ELSE 0 END)/&USD AS DISB_AMT_TU
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('Top-up')
									AND MIL20CUS ='Y'  THEN DISBURSED_CUS ELSE 0 END)/&USD AS DISB_AMT_TU20
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('Top-up')
									AND MIL20CUS ='N'  THEN DISBURSED_CUS ELSE 0 END)/&USD AS DISB_AMT_TU21
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('Top-up')
				THEN T3_AMT ELSE 0 END)/&USD AS DISB_AMT_TU_T3
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('Top-up')
				THEN CR_SHIELD_AMT ELSE 0 END)/&USD AS DISB_AMT_TU_SHIEDL
		/***************************************DISBUSAL PLAN********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT NOT IN ('Living need','Auto Loan')
										AND INDIRECT_FLAG ='INDIRECT'
										THEN 1 ELSE 0 END) AS IND_LOAN
		/***************************************DISBUSAL PLAN********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'Y'   THEN 1 ELSE 0 END) AS DP
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL'   THEN 1 ELSE 0 END) AS DP_PL
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL' AND MIL20 ='Y'  THEN 1 ELSE 0 END) AS DP_PL20
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL' AND MIL20 ='N'  THEN 1 ELSE 0 END) AS DP_PL21
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='Living need'   THEN 1 ELSE 0 END) AS DP_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='Auto Loan'   THEN 1 ELSE 0 END) AS DP_AUTO

		/***************************************DISBUSAL AMOUT PLAN********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'Y'  THEN LOAN_AMT ELSE 0 END)/&USD AS DP_AMT
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL'   THEN LOAN_AMT ELSE 0 END)/&USD AS DP_AMT_PL
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL' AND MIL20 ='Y'  THEN LOAN_AMT ELSE 0 END/&USD) AS DP_AMT_PL20
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL' AND MIL20 ='N'  THEN LOAN_AMT ELSE 0 END)/&USD AS DP_AMT_PL21
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='Living need'   THEN LOAN_AMT ELSE 0 END)/&USD AS DP_AMT_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='Auto Loan'   THEN LOAN_AMT ELSE 0 END)/&USD AS DP_AMT_AUTO
		/***************************************DISBUSAL AMOUT ACTUAL********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'Y'  THEN DISBURSED_AMT ELSE 0 END)/&USD AS DA_AMT
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL'   THEN DISBURSED_AMT ELSE 0 END)/&USD AS DA_AMT_PL
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL' AND MIL20 ='Y'  THEN DISBURSED_AMT ELSE 0 END/&USD) AS DA_AMT_PL20
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL' AND MIL20 ='N'  THEN DISBURSED_AMT ELSE 0 END)/&USD AS DA_AMT_PL21
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='Living need'   THEN DISBURSED_AMT ELSE 0 END)/&USD AS DA_AMT_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='Auto Loan'   THEN DISBURSED_AMT ELSE 0 END)/&USD AS DA_AMT_AUTO

		/**************************************PENDING CASE********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y'    THEN 1 ELSE 0 END) AS PEN
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y' AND PRODUCT_CAT ='PL'   THEN 1 ELSE 0 END) AS PEN_PL
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y' AND PRODUCT_CAT ='Living need'   THEN 1 ELSE 0 END) AS PEN_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y' AND PRODUCT_CAT ='Auto Loan'   THEN 1 ELSE 0 END) AS PEN_AUTO

		/***************************************PENDING AMOUNT********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y'   THEN LOAN_AMT ELSE 0 END)/&USD AS PEN_AMT
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y' AND PRODUCT_CAT ='PL'   THEN LOAN_AMT ELSE 0 END)/&USD AS PEN_AMT_PL
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y' AND PRODUCT_CAT ='Living need'   THEN LOAN_AMT ELSE 0 END)/&USD AS PEN_AMT_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y' AND PRODUCT_CAT ='Auto Loan'   THEN LOAN_AMT ELSE 0 END)/&USD AS PEN_AMT_AUTO
FROM TBL_POOL A
GROUP BY 1
;
RUN;

PROC SQL;
	CREATE TABLE  TBL_SUM2
	AS
	SELECT A.ITEM
			,A.WORKING_DATE 						AS 'Working date'n
			,B.AUT_TOTAL 							AS 'A.I Authorized loans'n	
			,B.AUT_PL								AS '1. Personal Loan'n
			,B.AUT_REGULAR							AS 'a. Regular'n
			,B.AUT_TOPUP            				AS 'b. Top-up'n	
			,B.AUT_EASY								AS 'c. Easy loan'n
			,B.AUT_LIVING							AS '2. Living need'n
			,B.AUT_AUTO								AS '3. Auto Loan'n
			,B.AUT_AMT_TOTAL						AS 'A.II Authorized amount (K$)'n	
			,B.AUT_AMT_PL							AS '1. Personal Loan (K$)'n
			,B.AUT_AMT_REGULAR						AS 'a. Regular (K$)'n
			,B.AUT_AMT_TOPUP						AS 'b. Top-up (K$)'n
			,B.AUT_AMT_EASY							AS 'c. Easy loan (K$)'n
			,B.AUT_AMT_LIVING						AS '2. Living need (K$)'n
			,B.AUT_AMT_AUTO							AS '3. Auto Loan (K$)'n
			,B.DEL_TOTAL							AS 'B.I Deleted cases after auth'n
			,B.DEL_PL								AS '1. Deleted - Personal Loan'n
			,B.DEL_LIVING							AS '2. Deleted - Living need'n
			,B.DEL_AUTO								AS '3. Deleted - Auto Loan'n
			,B.DEL_AMT_TOTAL						AS 'B.II Deleted auth amount (K$)'n
			,B.DEL_AMT_PL							AS '1. Deleted - Personal Loan (K$)'n
			,B.DEL_AMT_LIVING						AS '2. Deleted - Living need (K$)'n
			,B.DEL_AMT_AUTO							AS '3. Deleted - Auto Loan (K$)'n
			,B.AUT_TOTAL - B.DEL_TOTAL 				AS 'C.I Net loans auth'n
			,B.AUT_PL - B.DEL_PL  					AS '1. Net - Personal Loan'n 
			,B.AUT_PL_20MIL - B.DEL_PLMIL20  		AS 'a. Loan amt <= 20 Mil'n 
			,B.AUT_PL_21MIL - B.DEL_PLMIL21  		AS 'b. Loan amt > 20 Mil'n 
			,B.AUT_LIVING - B.DEL_LIVING  			AS '2. Net - Living need'n
			,B.AUT_AUTO - B.DEL_AUTO 				AS '3. Net - Auto Loan'n 
			,B.AUT_AMT_TOTAL - B.DEL_AMT_TOTAL  	AS 'C.II Net loans amount (K$)'n
			,B.AUT_AMT_PL - B.DEL_AMT_PL 			AS '1. Net - Personal Loan (K$)'n 
			,B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20	AS 'a. Loan amt <= 20 Mil(K$)'n
			,B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21	AS 'b. Loan amt > 20 Mil(K$)'n
			,B.AUT_AMT_LIVING - B.DEL_AMT_LIVING 	AS '2. Net - Living need  (K$)'n
			,B.AUT_AMT_AUTO	- B.DEL_AMT_AUTO	 	AS '3. Net - Auto Loan  (K$)'n 

			,B.DISB_AMT_PL_P1
				+ B.DISB_AMT_PL_T3_P1 
				+ B.DISB_AMT_PL_SHIEDL_P1 			AS 'D.I1 PL D/I Amt<=20Mil'n
			,B.DISB_AMT_PL_P1 			 			AS '1. Disbursal to customer (K$)'n 		
			,B.DISB_AMT_PL_T3_P1					AS '2. Disbursal to 3rd_Party(K$)'n
			,B.DISB_AMT_PL_SHIEDL_P1				AS '3. Credit Shield(K$)'n

			,B.DISB_AMT_PL_P2 
				+ B.DISB_AMT_PL_T3_P2
				+ B.DISB_AMT_PL_SHIEDL_P2           AS 'D.I2 PL D/I Amt(20:100]Mil'n
			,B.DISB_AMT_PL_P2 			 			AS '1. Disbursal to customer(K$)'n 		
			,B.DISB_AMT_PL20_P2						AS 'a. Equal or less than 20 Mil(K$)'n
			,B.DISB_AMT_PL21_P2						AS 'b. More than 20 Mil(K$)'n	
			,B.DISB_AMT_PL_T3_P2					AS '2. Disbursal to 3rd Party(K$)'n
			,B.DISB_AMT_PL_SHIEDL_P2				AS '3. Credit Shield (K$)'n

			,B.DISB_AMT_TU 
				+ B.DISB_AMT_TU_T3
				+ B.DISB_AMT_TU_SHIEDL  AS 'D.II Top-up - Direct/Indirect'n
			,B.DISB_AMT_TU							AS '1.Disbursal to customer(K$)'n 
			,B.DISB_AMT_TU20						AS 'a. Equal or less than 20Mil (K$)'n	
			,B.DISB_AMT_TU21						AS 'b. More than 20Mil (K$)'n	
			,B.DISB_AMT_TU_T3						AS '2.Disbursal to 3rd Party (K$)'n	
			,B.DISB_AMT_TU_SHIEDL					AS '3.Credit Shield(K$)'n
			,COALESCE((B.DISB_AMT_PL_P1 + B.DISB_AMT_PL_T3_P1 + B.DISB_AMT_PL20_P2 + B.DISB_AMT_PL_T3_P2  )/(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20 + B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21),.)
				+ COALESCE((B.DISB_AMT_TU20 + B.DISB_AMT_TU_T3)/(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20 + B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21  ),.)
				+ COALESCE((B.DISB_AMT_PL_SHIEDL_P1 + B.DISB_AMT_PL_SHIEDL_P2 + B.DISB_AMT_TU_SHIEDL)/(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20 + B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21  ),.) 
				AS 'D.III Indirect monitoring'n
/*			,B.IND_LOAN								AS '1. Indirect disbursal loan'n*/
			,COALESCE((B.DISB_AMT_PL_P1 + B.DISB_AMT_PL_T3_P1 + B.DISB_AMT_PL20_P2 + B.DISB_AMT_PL_T3_P2  )/(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20 + B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21),.)
													AS '1. % Indirect - Regular'n
			,COALESCE((B.DISB_AMT_PL_P1 + B.DISB_AMT_PL_T3_P1 )/(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20 ),.)
													AS 'a. Loan amt<= 20 Mil(K$)'n
			,COALESCE((B.DISB_AMT_PL20_P2 + B.DISB_AMT_PL_T3_P2 )/(B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21),.)
													AS 'b. Loan amt> 20 Mil(K$)'n

			,COALESCE((B.DISB_AMT_TU20 + B.DISB_AMT_TU_T3)/(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20 + B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21  ),.)
													AS '2. % Indirect - Top-up'n
			,COALESCE((B.DISB_AMT_PL_SHIEDL_P1 + B.DISB_AMT_PL_SHIEDL_P2 + B.DISB_AMT_TU_SHIEDL)/(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20 + B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21  ),.)
													AS '3. % Indirect - CS'n
			,B.DP	AS 'E.I Loan disbursed'n
			,B.DP_PL	AS '1. Disbursed- Personal Loan'n	
			,B.DP_PL20	AS 'a. Equal or less than 20Mil'n
			,B.DP_PL21	AS 'b. More than 20Mil'n
			,B.DP_LIVING	AS '2. Disbursed- Living need'n
			,B.DP_AUTO		AS '3. Disbursed- Auto Loan'n
			,B.DP_AMT		AS 'E.II Disbursed amount Plan(K$)'n
			,B.DP_AMT_PL	AS '1. Plan- Personal Loan'n
			,B.DP_AMT_PL20	AS 'a. Equal or less than 20Mil(K$) 'n
			,B.DP_AMT_PL21	AS 'b. More than 20Mil(K$) 'n
			,B.DP_AMT_LIVING	AS '2. Plan- Living need'n
			,B.DP_AMT_AUTO	AS '3. Plan- Auto Loan'n
			,B.DA_AMT	 AS 'E.III Disbursed amount Act(K$)'n
			,B.DA_AMT_PL	AS '1. Actual- Personal Loan'n
			,B.DA_AMT_PL20	AS 'a. Equal or less than 20Mil(K$ )'n
			,B.DA_AMT_PL21	AS 'b. More than than 20Mil(K$ )'n
			,B.DA_AMT_LIVING AS '2. Actual- Living need'n	
			,B.DA_AMT_AUTO		AS '3. Actual- Auto Loan'n
			,B.PEN	AS 'F.I Pending disbursment 'n
			,B.PEN_PL	AS '1. Pending - Personal Loan'n
			,B.PEN_LIVING	AS '2. Pending - Living need'n
			,B.PEN_AUTO	AS '3. Pending -  Auto Loan'n
			,B.PEN_AMT AS 'F.II Pending disbursement (K$) 'n
			,B.PEN_AMT_PL	AS '1. Pending - Personal Loan (K$)'n
			,B.PEN_AMT_LIVING	AS '2. Pending - Living need (K$)'n
			,B.PEN_AMT_AUTO AS '3. Pending -  Auto Loan (K$)'n
	FROM TBL_TEMPLATE1 A
	LEFT JOIN TBL_SUM1 B ON A.ITEM=B.ITEM
;
RUN;
QUIT;


proc transpose data=work.TBL_SUM2
out=work.TBL_SUM3
;
run;

PROC SQL;
CREATE TABLE CFCPUB01.MIS_AUTHORIZED_SUMMARY1
AS
SELECT 	_NAME_ 	AS 'Item'n
		,COL1	AS 'Week 1'n
		,COL2	AS 'Week 2'n
		,COL3	AS 'Week 3'n
		,COL4	AS 'Week 4'n
		,COL5	AS 'Week 5'n
		,COL6	AS 'Week 6'n
		,COL7	AS 'FTD'n
		,COL8	AS 'MTD Cur_month'n
		,COL9	AS 'MTD Las_month'n
		,COL10	AS 'MTD Las_year'n

		,( CASE WHEN COL8 > 1 THEN  COL8/COL9 -1 
				WHEN COL8 =0 THEN  0 
				ELSE  COL8 - COL9 END )
				AS 'Vs. Las_month'n
		,( CASE WHEN COL8 > 1 THEN  COL8/COL10 -1 
				WHEN COL8 =0 THEN  0 
				ELSE  COL8 - COL10 END ) 	AS 'Vs. Las_Year'n
		,COL11	AS 'EOM Cur_month'n
		,COL12	AS 'EOM Las_month'n
		,( CASE WHEN COL11 > 1 THEN  COL11/COL12 -1 
				WHEN COL11 =0 THEN  0 
				ELSE  COL11 - COL10 END ) 	AS 'Vs.'n
FROM TBL_SUM3
;
RUN;


proc contents data=  CFCPUB01.MIS_AUTHORIZED_SUMMARY1; run;

6. Summary by date

PROC SQL;
CREATE TABLE TBL_POOL_DATE
AS

	SELECT 
			DATE_AUTH AS ITEM
			,'N' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE authorized_date >= "&BOM_Cur"D AND MONTH_AUTH = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			DATE_DISB AS ITEM
			,'Y' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE disbursed_date >= "&BOM_Cur"D AND MONTH_DISB = PUT(&EOMONTH,YYMMN6.) = MONTH
	UNION ALL
	SELECT 
			DATE_CLOS AS ITEM
			,'C' AS DISB_FLAG
			,*
	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE actual_closed_date >= "&BOM_Cur"D AND MONTH_CLOS = PUT(&EOMONTH,YYMMN6.)= MONTH
/*	UNION ALL*/
/*	SELECT */
/*			DATE_PEN AS ITEM*/
/*			,'P' AS DISB_FLAG*/
/*			,**/
/*	FROM CFCPUB01.TBL_RAW_DATA_FULL WHERE PENDING_DATE >= "&BOM_Cur"D AND MONTH_PEN = PUT(&EOMONTH,YYMMN6.)*/


;
RUN;
QUIT;

%let USD=23172500;

PROC SQL;
CREATE TABLE TBL_DATE1
AS
SELECT A.ITEM 
		/***********************************AUTHORIZED CASE********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'N' THEN 1 ELSE 0 END) AS AUT_TOTAL
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL'   THEN 1 ELSE 0 END) AS AUT_PL
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
																,'PL Card')
										THEN 1 ELSE 0 END) AS AUT_REGULAR
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND PRODUCT_NAME IN ('Top-up')
										THEN 1 ELSE 0 END) AS AUT_TOPUP
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND PRODUCT_NAME IN ('Easy Loan')
										THEN 1 ELSE 0 END) AS AUT_EASY
		
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND MIL20 ='Y'
										THEN 1 ELSE 0 END) AS AUT_PL_20MIL
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND MIL20 ='N'
										THEN 1 ELSE 0 END) AS AUT_PL_21MIL

		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='Living need'   THEN 1 ELSE 0 END) AS AUT_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='Auto Loan'   THEN 1 ELSE 0 END) AS AUT_AUTO
		/*************************************AUTHORIZED AMOUNT*******************************************/
		,SUM( CASE WHEN DISB_FLAG = 'N' THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_TOTAL
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL'   THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_PL
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
																,'PL Card')
										THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_REGULAR
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND PRODUCT_NAME IN ('Top-up')
										THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_TOPUP
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND PRODUCT_NAME IN ('Easy Loan')
										THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_EASY
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND MIL20 ='Y'
										THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_PL20MIL
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='PL' 
										AND MIL20 ='N'
										THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_PL21MIL
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='Living need'   THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'N' AND PRODUCT_CAT ='Auto Loan'   THEN LOAN_AMT ELSE 0 END)/&USD AS AUT_AMT_AUTO
		/***************************************DELETE CASE********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' THEN 1 ELSE 0 END) AS DEL_TOTAL
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='PL'   THEN 1 ELSE 0 END) AS DEL_PL
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='PL'  AND MIL20='Y' THEN 1 ELSE 0 END) AS DEL_PLMIL20
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='PL' AND MIL20='N'  THEN 1 ELSE 0 END) AS DEL_PLMIL21
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='Living need'   THEN 1 ELSE 0 END) AS DEL_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='Auto Loan'   THEN 1 ELSE 0 END) AS DEL_AUTO
		/***************************************DELETE AMOUT********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' THEN LOAN_AMT ELSE 0 END)/&USD AS DEL_AMT_TOTAL
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='PL'   THEN LOAN_AMT ELSE 0 END)/&USD AS DEL_AMT_PL
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='PL' AND MIL20='Y'   THEN LOAN_AMT ELSE 0 END)/&USD AS DEL_AMT_PLMIL20
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='PL' AND MIL20='N'  THEN LOAN_AMT ELSE 0 END)/&USD AS DEL_AMT_PLMIL21
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='Living need'   THEN LOAN_AMT ELSE 0 END)/&USD AS DEL_AMT_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'C' AND DELETE_FLAG ='Y' AND PRODUCT_CAT ='Auto Loan'   THEN LOAN_AMT ELSE 0 END)/&USD AS DEL_AMT_AUTO


		/***************************************DISBURSAL PL REGULAR PRODUCT********************************************/

		/*Part 1-Amount <=20mil*/

		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL'  AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
							,'PL Card','Easy Loan') AND MIL20 ='Y' THEN DISBURSED_CUS ELSE 0 END)/&USD AS DISB_AMT_PL_P1

		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
							,'PL Card','Easy Loan') AND MIL20 ='Y'   THEN T3_AMT ELSE 0 END)/&USD AS DISB_AMT_PL_T3_P1

		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
							,'PL Card','Easy Loan') AND MIL20 ='Y'  THEN CR_SHIELD_AMT ELSE 0 END)/&USD AS DISB_AMT_PL_SHIEDL_P1
		/*Part 2- Amount >20mil*/

		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL'  AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
											,'PL Card','Easy Loan') AND MIL20 ='N' THEN DISBURSED_CUS ELSE 0 END)/&USD AS DISB_AMT_PL_P2
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
																,'PL Card','Easy Loan') AND MIL20 ='N'
												AND MIL20CUS ='Y'  THEN DISBURSED_CUS ELSE 0 END)/&USD AS DISB_AMT_PL20_P2
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
																,'PL Card','Easy Loan')AND MIL20 ='N'
												AND MIL20CUS ='N'  THEN DISBURSED_CUS ELSE 0 END)/&USD AS DISB_AMT_PL21_P2
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
												,'PL Card','Easy Loan') AND MIL20 ='N'   THEN T3_AMT ELSE 0 END)/&USD AS DISB_AMT_PL_T3_P2
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('PL Self-emp','PL Salaried','PL Insurance','PL CELP'
												,'PL Card','Easy Loan') AND MIL20 ='N'   THEN CR_SHIELD_AMT ELSE 0 END)/&USD AS DISB_AMT_PL_SHIEDL_P2

		/***************************************DISBURSAL TOPUP PRODUCT********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' 
										AND PRODUCT_NAME IN ('Top-up')   THEN DISBURSED_CUS ELSE 0 END)/&USD AS DISB_AMT_TU
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('Top-up')
									AND MIL20CUS ='Y'  THEN DISBURSED_CUS ELSE 0 END)/&USD AS DISB_AMT_TU20
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('Top-up')
									AND MIL20CUS ='N'  THEN DISBURSED_CUS ELSE 0 END)/&USD AS DISB_AMT_TU21
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('Top-up')
				THEN T3_AMT ELSE 0 END)/&USD AS DISB_AMT_TU_T3
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT ='PL' AND PRODUCT_NAME IN ('Top-up')
				THEN CR_SHIELD_AMT ELSE 0 END)/&USD AS DISB_AMT_TU_SHIEDL
		/***************************************DISBUSAL PLAN********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'N' AND DELETE_FLAG ='N' AND PRODUCT_CAT NOT IN ('Living need','Auto Loan')
										AND INDIRECT_FLAG ='INDIRECT'
										THEN 1 ELSE 0 END) AS IND_LOAN
		/***************************************DISBUSAL PLAN********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'Y'   THEN 1 ELSE 0 END) AS DP
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL'   THEN 1 ELSE 0 END) AS DP_PL
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL' AND MIL20 ='Y'  THEN 1 ELSE 0 END) AS DP_PL20
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL' AND MIL20 ='N'  THEN 1 ELSE 0 END) AS DP_PL21
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='Living need'   THEN 1 ELSE 0 END) AS DP_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='Auto Loan'   THEN 1 ELSE 0 END) AS DP_AUTO

		/***************************************DISBUSAL AMOUT PLAN********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'Y'  THEN LOAN_AMT ELSE 0 END)/&USD AS DP_AMT
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL'   THEN LOAN_AMT ELSE 0 END)/&USD AS DP_AMT_PL
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL' AND MIL20 ='Y'  THEN LOAN_AMT ELSE 0 END/&USD) AS DP_AMT_PL20
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL' AND MIL20 ='N'  THEN LOAN_AMT ELSE 0 END)/&USD AS DP_AMT_PL21
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='Living need'   THEN LOAN_AMT ELSE 0 END)/&USD AS DP_AMT_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='Auto Loan'   THEN LOAN_AMT ELSE 0 END)/&USD AS DP_AMT_AUTO
		/***************************************DISBUSAL AMOUT ACTUAL********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'Y'  THEN DISBURSED_AMT ELSE 0 END)/&USD AS DA_AMT
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL'   THEN DISBURSED_AMT ELSE 0 END)/&USD AS DA_AMT_PL
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL' AND MIL20 ='Y'  THEN DISBURSED_AMT ELSE 0 END/&USD) AS DA_AMT_PL20
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='PL' AND MIL20 ='N'  THEN DISBURSED_AMT ELSE 0 END)/&USD AS DA_AMT_PL21
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='Living need'   THEN DISBURSED_AMT ELSE 0 END)/&USD AS DA_AMT_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'Y' AND PRODUCT_CAT ='Auto Loan'   THEN DISBURSED_AMT ELSE 0 END)/&USD AS DA_AMT_AUTO

		/**************************************PENDING CASE********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y'    THEN 1 ELSE 0 END) AS PEN
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y' AND PRODUCT_CAT ='PL'   THEN 1 ELSE 0 END) AS PEN_PL
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y' AND PRODUCT_CAT ='Living need'   THEN 1 ELSE 0 END) AS PEN_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y' AND PRODUCT_CAT ='Auto Loan'   THEN 1 ELSE 0 END) AS PEN_AUTO

		/***************************************PENDING AMOUNT********************************************/
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y'   THEN LOAN_AMT ELSE 0 END)/&USD AS PEN_AMT
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y' AND PRODUCT_CAT ='PL'   THEN LOAN_AMT ELSE 0 END)/&USD AS PEN_AMT_PL
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y' AND PRODUCT_CAT ='Living need'   THEN LOAN_AMT ELSE 0 END)/&USD AS PEN_AMT_LIVING
		,SUM( CASE WHEN DISB_FLAG = 'P' AND PENDING_FLAG='Y' AND PRODUCT_CAT ='Auto Loan'   THEN LOAN_AMT ELSE 0 END)/&USD AS PEN_AMT_AUTO
FROM TBL_POOL_DATE A
GROUP BY 1
;
RUN;

PROC SQL;
	CREATE TABLE  TBL_DATE2
	AS
	SELECT 	B.ITEM AS DAILY
			,B.AUT_TOTAL 							AS 'A.I Authorized loans'n	
			,B.AUT_PL								AS '1. Personal Loan'n
			,B.AUT_REGULAR							AS 'a. Regular'n
			,B.AUT_TOPUP            				AS 'b. Top-up'n	
			,B.AUT_EASY								AS 'c. Easy loan'n
			,B.AUT_LIVING							AS '2. Living need'n
			,B.AUT_AUTO								AS '3. Auto Loan'n
			,ROUND(B.AUT_AMT_TOTAL,.01)						AS 'A.II Authorized amount (K$)'n	
			,ROUND(B.AUT_AMT_PL	,.01)						AS '1. Personal Loan (K$)'n
			,ROUND(B.AUT_AMT_REGULAR,.01)						AS 'a. Regular (K$)'n
			,ROUND(B.AUT_AMT_TOPUP,.01)						AS 'b. Top-up (K$)'n
			,ROUND(B.AUT_AMT_EASY,.01)							AS 'c. Easy loan (K$)'n
			,ROUND(B.AUT_AMT_LIVING	,.01)					AS '2. Living need (K$)'n
			,ROUND(B.AUT_AMT_AUTO,.01)							AS '3. Auto Loan (K$)'n
			,B.DEL_TOTAL							AS 'B.I Deleted cases after auth'n
			,B.DEL_PL								AS '1. Deleted - Personal Loan'n
			,B.DEL_LIVING							AS '2. Deleted - Living need'n
			,B.DEL_AUTO								AS '3. Deleted - Auto Loan'n
			,ROUND(B.DEL_AMT_TOTAL,.01)						AS 'B.II Deleted auth amount (K$)'n
			,ROUND(B.DEL_AMT_PL	,.01)						AS '1. Deleted - Personal Loan (K$)'n
			,ROUND(B.DEL_AMT_LIVING,.01)					AS '2. Deleted - Living need (K$)'n
			,ROUND(B.DEL_AMT_AUTO,.01)							AS '3. Deleted - Auto Loan (K$)'n
			,B.AUT_TOTAL - B.DEL_TOTAL 				AS 'C.I Net loans auth'n
			,B.AUT_PL - B.DEL_PL  					AS '1. Net - Personal Loan'n 
			,B.AUT_PL_20MIL - B.DEL_PLMIL20  		AS 'a. Loan amt <= 20 Mil'n 
			,B.AUT_PL_21MIL - B.DEL_PLMIL21  		AS 'b. Loan amt > 20 Mil'n 
			,B.AUT_LIVING - B.DEL_LIVING  			AS '2. Net - Living need'n
			,B.AUT_AUTO - B.DEL_AUTO 				AS '3. Net - Auto Loan'n 
			,ROUND(B.AUT_AMT_TOTAL - B.DEL_AMT_TOTAL,.01)  	AS 'C.II Net loans amount (K$)'n
			,ROUND(B.AUT_AMT_PL - B.DEL_AMT_PL ,.01)			AS '1. Net - Personal Loan (K$)'n 
			,ROUND(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20,.01)	AS 'a. Loan amt <= 20 Mil(K$)'n
			,ROUND(B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21,.01)	AS 'b. Loan amt > 20 Mil(K$)'n
			,ROUND(B.AUT_AMT_LIVING - B.DEL_AMT_LIVING,.01) 	AS '2. Net - Living need  (K$)'n
			,ROUND(B.AUT_AMT_AUTO	- B.DEL_AMT_AUTO,.01)	 	AS '3. Net - Auto Loan  (K$)'n 

			,ROUND(B.DISB_AMT_PL_P1
				+ B.DISB_AMT_PL_T3_P1 
				+ B.DISB_AMT_PL_SHIEDL_P1 ,.01)			AS 'D.I1 PL D/I Amt<=20Mil'n
			,ROUND(B.DISB_AMT_PL_P1,.01) 			 			AS '1. Disbursal to customer (K$)'n 		
			,ROUND(B.DISB_AMT_PL_T3_P1,.01)					AS '2. Disbursal to 3rd_Party(K$)'n
			,ROUND(B.DISB_AMT_PL_SHIEDL_P1,.01)				AS '3. Credit Shield(K$)'n

			,ROUND(B.DISB_AMT_PL_P2 
				+ B.DISB_AMT_PL_T3_P2
				+ B.DISB_AMT_PL_SHIEDL_P2,.01)           AS 'D.I2 PL D/I Amt(20:100]Mil'n
			,ROUND(B.DISB_AMT_PL_P2 ,.01)			 			AS '1. Disbursal to customer(K$)'n 		
			,ROUND(B.DISB_AMT_PL20_P2,.01)						AS 'a. Equal or less than 20 Mil(K$)'n
			,ROUND(B.DISB_AMT_PL21_P2,.01)						AS 'b. More than 20 Mil(K$)'n	
			,ROUND(B.DISB_AMT_PL_T3_P2,.01)					AS '2. Disbursal to 3rd Party(K$)'n
			,ROUND(B.DISB_AMT_PL_SHIEDL_P2,.01)				AS '3. Credit Shield (K$)'n

			,ROUND(B.DISB_AMT_TU 
				+ B.DISB_AMT_TU_T3
				+ B.DISB_AMT_TU_SHIEDL,.01)  AS 'D.II Top-up - Direct/Indirect'n
			,ROUND(B.DISB_AMT_TU,.01)							AS '1.Disbursal to customer(K$)'n 
			,ROUND(B.DISB_AMT_TU20,.01)						AS 'a. Equal or less than 20Mil (K$)'n	
			,ROUND(B.DISB_AMT_TU21,.01)						AS 'b. More than 20Mil (K$)'n	
			,ROUND(B.DISB_AMT_TU_T3,.01)						AS '2.Disbursal to 3rd Party (K$)'n	
			,ROUND(B.DISB_AMT_TU_SHIEDL	,.01)				AS '3.Credit Shield(K$)'n
			,ROUND((B.DISB_AMT_PL_P1 + B.DISB_AMT_PL_T3_P1 + B.DISB_AMT_PL20_P2 + B.DISB_AMT_PL_T3_P2  )/(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20 + B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21),.0001)
				+ ROUND((B.DISB_AMT_TU20 + B.DISB_AMT_TU_T3)/(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20 + B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21  ),.0001)
				+ ROUND((B.DISB_AMT_PL_SHIEDL_P1 + B.DISB_AMT_PL_SHIEDL_P2 + B.DISB_AMT_TU_SHIEDL)/(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20 + B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21  ),.0001) 
				AS 'D.III Indirect monitoring'n
/*			,B.IND_LOAN								AS '1. Indirect disbursal loan'n*/
			,ROUND((B.DISB_AMT_PL_P1 + B.DISB_AMT_PL_T3_P1 + B.DISB_AMT_PL20_P2 + B.DISB_AMT_PL_T3_P2  )/(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20 + B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21),.0001)
													AS '1. % Indirect - Regular'n
			,ROUND((B.DISB_AMT_PL_P1 + B.DISB_AMT_PL_T3_P1 )/(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20 ),.0001)
													AS 'a. Loan amt<= 20 Mil(K$)'n
			,ROUND((B.DISB_AMT_PL20_P2 + B.DISB_AMT_PL_T3_P2 )/(B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21),.0001)
													AS 'b. Loan amt> 20 Mil(K$)'n

			,ROUND((B.DISB_AMT_TU20 + B.DISB_AMT_TU_T3)/(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20 + B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21  ),.0001)
													AS '2. % Indirect - Top-up'n
			,ROUND((B.DISB_AMT_PL_SHIEDL_P1 + B.DISB_AMT_PL_SHIEDL_P2 + B.DISB_AMT_TU_SHIEDL)/(B.AUT_AMT_PL20MIL - B.DEL_AMT_PLMIL20 + B.AUT_AMT_PL21MIL - B.DEL_AMT_PLMIL21  ),.0001)
													AS '3. % Indirect - CS'n
			,B.DP	AS 'E.I Loan disbursed'n
			,B.DP_PL	AS '1. Disbursed- Personal Loan'n	
			,B.DP_PL20	AS 'a. Equal or less than 20Mil'n
			,B.DP_PL21	AS 'b. More than 20Mil'n
			,B.DP_LIVING	AS '2. Disbursed- Living need'n
			,B.DP_AUTO		AS '3. Disbursed- Auto Loan'n
			,ROUND(B.DP_AMT,.01)	AS 'E.II Disbursed amount Plan(K$)'n
			,ROUND(B.DP_AMT_PL,.01)	AS '1. Plan- Personal Loan'n
			,ROUND(B.DP_AMT_PL20,.01)	AS 'a. Equal or less than 20Mil(K$) 'n
			,ROUND(B.DP_AMT_PL21,.01)	AS 'b. More than 20Mil(K$) 'n
			,ROUND(B.DP_AMT_LIVING,.01)	AS '2. Plan- Living need'n
			,ROUND(B.DP_AMT_AUTO,.01)	AS '3. Plan- Auto Loan'n
			,ROUND(B.DA_AMT,.01)	 AS 'E.III Disbursed amount Act(K$)'n
			,ROUND(B.DA_AMT_PL,.01)	AS '1. Actual- Personal Loan'n
			,ROUND(B.DA_AMT_PL20,.01)	AS 'a. Equal or less than 20Mil(K$ )'n
			,ROUND(B.DA_AMT_PL21,.01)	AS 'b. More than than 20Mil(K$ )'n
			,ROUND(B.DA_AMT_LIVING,.01) AS '2. Actual- Living need'n	
			,ROUND(B.DA_AMT_AUTO,.01)		AS '3. Actual- Auto Loan'n
	FROM TBL_DATE1 B 
;
RUN;
QUIT;


proc transpose data=work.TBL_DATE2
out=work.TBL_DATE3
;
run;

PROC SQL;
CREATE TABLE CFCPUB01.MIS_AUTHORIZED_SUMMARY2
AS
SELECT 	*
		
FROM TBL_DATE3
;
RUN;


proc contents data= CFCPUB01.MIS_AUTHORIZED_SUMMARY2 ; run;
